<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»™äº²çˆ±çš„å§å§æ¨å‹¤çš„ç”Ÿæ—¥æƒŠå–œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 1s ease;
            overflow: hidden;
        }
        
        .bg-1 {
            background: linear-gradient(135deg, #ffecf1 0%, #ffdde7 100%);
        }
        
        .bg-2 {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe8cc 100%);
        }
        
        .bg-3 {
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f2ff 100%);
        }
        
        .bg-4 {
            background: linear-gradient(135deg, #f9f0ff 0%, #f0e6ff 100%);
        }
        
        .bg-5 {
            background: linear-gradient(135deg, #f0fff4 0%, #e6ffec 100%);
        }
        
        .bg-6 {
            background: linear-gradient(135deg, #fffaf0 0%, #fff5e6 100%);
        }
        
        .bg-7 {
            background: linear-gradient(135deg, #f8f0ff 0%, #f0e6ff 100%);
        }
        
        .bg-8 {
            background: linear-gradient(135deg, #fff0f5 0%, #ffe6ee 100%);
        }
        
        .main-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90%;
            max-width: 420px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
            padding: 30px;
            text-align: center;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            border: 3px solid #ffccd5;
        }
        
        .main-modal.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .main-modal h2 {
            color: #ff6b9d;
            margin-bottom: 20px;
            font-size: 28px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .main-modal p {
            color: #666;
            margin-bottom: 25px;
            font-size: 17px;
            line-height: 1.6;
        }
        
        .highlight {
            color: #ff6b9d;
            font-weight: bold;
            font-size: 20px;
        }
        
        .main-modal button {
            background: linear-gradient(135deg, #ff6b9d 0%, #ff8fab 100%);
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
            font-weight: bold;
            margin-top: 10px;
        }
        
        .main-modal button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.6);
        }
        
        .mini-modal {
            position: fixed;
            width: 200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            opacity: 0;
            z-index: 999;
            cursor: pointer;
            user-select: none;
            border: 2px solid #ffccd5;
        }
        
        .mini-modal.effect-1 {
            transform: scale(0.8) translateY(-30px);
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .mini-modal.effect-2 {
            transform: scale(0.6) translateX(-50px);
            transition: all 0.7s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .mini-modal.effect-3 {
            transform: scale(0.7) rotate(-10deg);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .mini-modal.active.effect-1 {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        
        .mini-modal.active.effect-2 {
            opacity: 1;
            transform: scale(1) translateX(0);
        }
        
        .mini-modal.active.effect-3 {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
        
        .mini-modal.clicked {
            animation: clickEffect 0.6s ease;
        }
        
        @keyframes clickEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        
        .mini-modal-header {
            padding: 10px 15px;
            color: white;
            font-weight: bold;
            text-align: center;
            font-size: 15px;
        }
        
        .mini-modal-content {
            padding: 15px;
            background-color: #fff9fc;
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            text-align: center;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .text-effect-fadein .mini-modal-content {
            animation: fadeIn 2s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .heart {
            position: absolute;
            font-size: 24px;
            color: #ff6b9d;
            pointer-events: none;
            z-index: 1000;
            animation: heartFloat 1s ease-out forwards;
        }
        
        @keyframes heartFloat {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(0, -50px) scale(1.5);
            }
        }
        
        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 107, 157, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2000;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
            transition: all 0.3s ease;
        }
        
        .music-control:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 107, 157, 0.5);
        }
        
        .music-control.muted {
            background: rgba(153, 153, 153, 0.7);
        }
        
        .music-icon {
            font-size: 24px;
            color: white;
        }
        
        .music-control.muted .music-icon::before {
            content: "ğŸ”‡";
        }
        
        .music-control:not(.muted) .music-icon::before {
            content: "ğŸµ";
        }
        
        .music-control.hidden {
            display: none;
        }
        
        .copyright {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: rgba(0, 0, 0, 0.3);
            font-size: 12px;
            z-index: 1000;
        }
        
        .header-color-1 { background-color: #ff6b9d; }
        .header-color-2 { background-color: #ff8fab; }
        .header-color-3 { background-color: #36c; }
        .header-color-4 { background-color: #4caf50; }
        .header-color-5 { background-color: #ff9800; }
        .header-color-6 { background-color: #9c27b0; }
        .header-color-7 { background-color: #2196f3; }
        .header-color-8 { background-color: #ff5722; }
        .header-color-9 { background-color: #00bcd4; }
        .header-color-10 { background-color: #8bc34a; }
        .header-color-11 { background-color: #795548; }
        .header-color-12 { background-color: #607d8b; }
        .header-color-13 { background-color: #e91e63; }
        .header-color-14 { background-color: #3f51b5; }
        .header-color-15 { background-color: #009688; }
        .header-color-16 { background-color: #ffc107; }
        .header-color-17 { background-color: #673ab7; }
        .header-color-18 { background-color: #f44336; }
        .header-color-19 { background-color: #cddc39; }
        .header-color-20 { background-color: #00bcd4; }
        
        /* æ–°å¢è›‹ç³•å›¾æ ‡ */
        .cake-icon {
            font-size: 40px;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* ç”Ÿæ—¥è£…é¥°å›¾æ ‡ */
        .decoration-icon {
            font-size: 30px;
            margin: 0 5px;
        }
        
        @media (max-width: 768px) {
            .mini-modal {
                width: 170px;
            }
            
            .mini-modal-content {
                font-size: 13px;
                min-height: 80px;
                padding: 12px;
            }
            
            .mini-modal-header {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            .music-control {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
            }
            
            .music-icon {
                font-size: 20px;
            }
            
            .main-modal {
                padding: 25px;
                max-width: 350px;
            }
            
            .main-modal h2 {
                font-size: 24px;
            }
        }
        
        @keyframes bgChange {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        body.bg-changing {
            animation: bgChange 1s ease;
        }
        
        /* ç”Ÿæ—¥ä¸»é¢˜è£…é¥° */
        .birthday-decoration {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body class="bg-1">
    <div id="musicControl" class="music-control hidden">
        <div class="music-icon"></div>
    </div>
    
    <div class="main-modal" id="mainModal">
        <div class="cake-icon">ğŸ‚</div>
        <h2>ç»™äº²çˆ±çš„å§å§çš„ç”Ÿæ—¥æƒŠå–œ</h2>
        <p>äº²çˆ±çš„<span class="highlight">æ¨å‹¤å§å§</span>ï¼š</p>
        <p>ä»Šå¤©æ˜¯ä½ çš„ç”Ÿæ—¥ï¼Œæ„¿ä½ è¢«çˆ±åŒ…å›´ï¼Œå¹¸ç¦æ»¡æ»¡ï¼</p>
        <p>ä½œä¸ºå¼Ÿå¼Ÿï¼Œæˆ‘ä¸ºä½ å‡†å¤‡äº†è¿™ä»½ç‰¹åˆ«çš„ç¤¼ç‰©ï¼Œå¸Œæœ›ä½ å–œæ¬¢ï¼</p>
        <div class="birthday-decoration">
            <span class="decoration-icon">ğŸˆ</span>
            <span class="decoration-icon">ğŸ</span>
            <span class="decoration-icon">âœ¨</span>
            <span class="decoration-icon">â¤ï¸</span>
        </div>
        <button id="confirmBtn">æ‰“å¼€ç”Ÿæ—¥ç¥ç¦å¼¹çª—</button>
    </div>
    
    <div class="copyright">å¼Ÿå¼Ÿé€ç»™æœ€æ£’çš„å§å§ â¤ï¸</div>

    <script>
        function getUrlParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // å§å§çš„åå­—
        const sisterName = "æ¨å‹¤";
        const musicName = getUrlParam('music') || 'ç”Ÿæ—¥å¿«ä¹æ­Œ';
        
        // ç”Ÿæ—¥ç¥ç¦è¯­ï¼ˆçº¯ç”Ÿæ—¥ç¥ç¦ï¼Œä¸å«åˆ›ä¸šå†…å®¹ï¼‰
        const birthdayMessages = [
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰å’Œæ¬¢ç¬‘ï¼`,
            `å§å§ï¼Œä½ æ˜¯æœ€æ£’çš„ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ„¿ä½ æ°¸è¿œç¾ä¸½å¦‚èŠ±ï¼`,
            `äº²çˆ±çš„æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼å¼Ÿå¼Ÿæ°¸è¿œçˆ±ä½ ã€æ”¯æŒä½ ï¼`,
            `å§å§ç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„ç”Ÿæ´»ç”œç”œèœœèœœï¼Œå¹¸ç¦ç¾æ»¡ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ å¿ƒæƒ³äº‹æˆï¼Œä¸‡äº‹å¦‚æ„ï¼`,
            `å§å§ï¼Œçœ‹åˆ°ä½ å¹¸ç¦çš„ç¬‘å®¹æ˜¯æˆ‘æœ€å¤§çš„å¿«ä¹ï¼ç”Ÿæ—¥å¿«ä¹ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ è¢«çˆ±åŒ…å›´ï¼Œæ¸©æš–å¸¸ä¼´ï¼`,
            `å§å§ç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„ä¸–ç•Œæ°¸è¿œå……æ»¡çˆ±ä¸ç¾å¥½ï¼`,
            `ç»™æœ€äº²çˆ±çš„æ¨å‹¤å§å§ï¼šç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œå¹´è½»æ¼‚äº®ï¼`,
            `å§å§ï¼Œä½ æ˜¯æˆ‘æœ€æ•¬ä½©çš„å¥³æ€§ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œå¥åº·å¿«ä¹ï¼`,
            `æ¨å‹¤å§å§ç”Ÿæ—¥å¿«ä¹ï¼æœŸå¾…å’Œä½ ä¸€èµ·åˆ›é€ æ›´å¤šç¾å¥½å›å¿†ï¼`,
            `å§å§ï¼Œå†å¿™ä¹Ÿè¦ç…§é¡¾å¥½è‡ªå·±ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œå¥åº·ç¾ä¸½ï¼`,
            `äº²çˆ±çš„å§å§ï¼Œä½ æ˜¯å¼Ÿå¼Ÿå¿ƒä¸­æ°¸è¿œçš„æ¦œæ ·ï¼ç”Ÿæ—¥å¿«ä¹ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿è´µäººå¸¸ç›¸ä¼´ï¼Œå¥½è¿è¿è¿ï¼`,
            `å§å§ï¼Œä½ çš„å–„è‰¯å’Œæ¸©æŸ”è®©æˆ‘æ•¬ä½©ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œå¹¸ç¦ï¼`,
            `ç”Ÿæ—¥å¿«ä¹ï¼æ¨å‹¤å§å§ï¼Œæ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰ï¼`,
            `å§å§ï¼Œä½ æ˜¯æœ€é—ªè€€çš„æ˜Ÿæ˜Ÿï¼ç”Ÿæ—¥å¿«ä¹ï¼Œç…§äº®æˆ‘çš„ä¸–ç•Œï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«å¿«ä¹ä¹ï¼æ„¿ä½ çš„ç”Ÿæ´»ç²¾å½©çº·å‘ˆï¼`,
            `å§å§ï¼Œä¸ç®¡å¤šå¿™ï¼Œå®¶é‡Œæ°¸è¿œæ˜¯ä½ çš„æ¸¯æ¹¾ï¼ç”Ÿæ—¥å¿«ä¹ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼å¼Ÿå¼Ÿä¼šä¸€ç›´åšä½ æœ€åšå®çš„åç›¾ï¼`,
            `å§å§ï¼Œä½ çš„ç”Ÿæ—¥æ„¿æœ›ä¸€å®šéƒ½ä¼šå®ç°ï¼Œå› ä¸ºä½ æ˜¯æœ€æ£’çš„ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿é›¨åè§å½©è™¹ï¼Œç”Ÿæ´»æ›´ç¿çƒ‚ï¼`,
            `å§å§ç”Ÿæ—¥å¿«ä¹ï¼æˆ‘è¦åˆ°å¤„ç‚«è€€æˆ‘æœ‰ä¸ªè¶…å¥½çš„å§å§ï¼`,
            `æ¨å‹¤å§å§ï¼Œæˆé•¿è·¯ä¸Šä½ ä¸€ç›´é™ªä¼´æˆ‘ï¼Œç”Ÿæ—¥å¿«ä¹ï¼`,
            `å§å§ï¼Œä½ çš„æ¸©æŸ”å’Œå–„è‰¯è®©æˆ‘éª„å‚²ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œçˆ±ä½ ï¼`,
            `æ¨å‹¤å§å§ç”Ÿæ—¥å¿«ä¹ï¼æ„¿æ–°çš„ä¸€å²ï¼Œä½ çš„ç”Ÿæ´»æ›´ç²¾å½©ï¼`,
            `å§å§ï¼Œä½ æ˜¯æœ€ç¾çš„å¤©ä½¿ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œå¹¸ç¦ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«å¿«ä¹ä¹ï¼æ„¿ä½ çš„åŠªåŠ›ç»ˆæœ‰å›æŠ¥ï¼`,
            `å§å§ï¼Œç”Ÿæ´»è®©ä½ æ›´é—ªè€€ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæˆ‘çš„å¶åƒå§å§ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„å®¶åº­å’Œç¦ï¼Œå¹¸ç¦ç¾æ»¡ï¼`,
            `å§å§ï¼Œä½ çš„æ™ºæ…§å’Œå–„è‰¯æ˜¯å¹¸ç¦çš„æºæ³‰ï¼ç”Ÿæ—¥å¿«ä¹ï¼`,
            `ç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„å®¶äººå¥åº·ï¼Œæœ‹å‹å¸¸åœ¨ï¼Œå¿«ä¹æ°¸è¿œï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«å¿«ä¹ä¹ï¼å¼Ÿå¼Ÿä»¥ä½ ä¸ºè£ï¼Œæ°¸è¿œçˆ±ä½ ï¼`,
            `å§å§ï¼Œç”Ÿæ´»è®©ä½ çš„äººç”Ÿæ›´ç²¾å½©ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œå¹´è½»ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ çš„ç¬‘å®¹æ°¸è¿œç¿çƒ‚å¦‚èŠ±ï¼`,
            `å§å§ï¼Œä½ æ˜¯æœ€æ¸©æš–çš„å­˜åœ¨ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œå¿«ä¹ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«å¿«ä¹ä¹ï¼æ„¿ä½ æ¢¦æƒ³æˆçœŸï¼Œå¿«ä¹æ¯ä¸€å¤©ï¼`,
            `å§å§ï¼Œä½ çš„åšæŒå’Œæ¯…åŠ›è®©æˆ‘æ„ŸåŠ¨ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œæ°¸è¿œæ”¯æŒä½ ï¼`,
            `æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼æ„¿ä½ å¹³è¡¡å·¥ä½œä¸ç”Ÿæ´»ï¼Œå¹¸ç¦ç¾æ»¡ï¼`,
            `å§å§ï¼Œä½ æ˜¯å¼Ÿå¼Ÿå¿ƒä¸­æ°¸è¿œçš„å¥³ç¥ï¼ç”Ÿæ—¥å¿«ä¹ï¼Œçˆ±ä½ ä¸‰åƒéï¼`
        ];
        
        const bgClasses = ['bg-1', 'bg-2', 'bg-3', 'bg-4', 'bg-5', 'bg-6', 'bg-7', 'bg-8'];
        const headerClasses = [
            'header-color-1', 'header-color-2', 'header-color-3', 
            'header-color-4', 'header-color-5', 'header-color-6',
            'header-color-7', 'header-color-8', 'header-color-9',
            'header-color-10', 'header-color-11', 'header-color-12',
            'header-color-13', 'header-color-14', 'header-color-15',
            'header-color-16', 'header-color-17', 'header-color-18',
            'header-color-19', 'header-color-20'
        ];
        
        let backgroundMusic = null;
        let isMusicPlaying = false;
        let isMusicMuted = false;
        
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   window.innerWidth <= 768;
        }
        
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let currentDragElement = null;
        
        window.addEventListener('DOMContentLoaded', function() {
            const mainModal = document.getElementById('mainModal');
            const musicControl = document.getElementById('musicControl');
            const randomBg = bgClasses[Math.floor(Math.random() * bgClasses.length)];
            document.body.className = randomBg;
            
            // æ€»æ˜¯æ˜¾ç¤ºéŸ³ä¹æ§åˆ¶
            musicControl.classList.remove('hidden');
            loadBackgroundMusic(musicName);
            
            // ä¿®æ”¹é¡µé¢æ ‡é¢˜
            document.title = `ç»™æ¨å‹¤å§å§çš„ç”Ÿæ—¥æƒŠå–œ | ç”Ÿæ—¥å¿«ä¹`;
            
            setTimeout(() => {
                mainModal.classList.add('active');
            }, 300);
        });
        
        function loadBackgroundMusic(songName) {
            // ä½¿ç”¨ç”Ÿæ—¥å¿«ä¹æ­Œ
            const apiUrl = `https://api.jkyai.top/API/wyyyjs.php?msg=${encodeURIComponent(songName)}&n=1`;
            
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200 && data.data.media.audio_url) {
                        backgroundMusic = new Audio(data.data.media.audio_url);
                        backgroundMusic.loop = true;
                        backgroundMusic.volume = 0.5;
                        
                        document.getElementById('confirmBtn').addEventListener('click', function() {
                            if (backgroundMusic && !isMusicMuted) {
                                backgroundMusic.play().catch(e => console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', e));
                                isMusicPlaying = true;
                            }
                        });
                        
                        setupMusicControl();
                    } else {
                        // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨å¤‡é€‰éŸ³ä¹
                        setupBackupMusic();
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½éŸ³ä¹å¤±è´¥:', error);
                    setupBackupMusic();
                });
        }
        
        function setupBackupMusic() {
            // å¤‡é€‰ç”Ÿæ—¥å¿«ä¹éŸ³ä¹
            backgroundMusic = new Audio('https://assets.mixkit.co/music/preview/mixkit-happy-birthday-to-you-443.mp3');
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.5;
            
            document.getElementById('confirmBtn').addEventListener('click', function() {
                if (backgroundMusic && !isMusicMuted) {
                    backgroundMusic.play().catch(e => console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', e));
                    isMusicPlaying = true;
                }
            });
            
            setupMusicControl();
        }
        
        function setupMusicControl() {
            const musicControl = document.getElementById('musicControl');
            
            musicControl.addEventListener('click', function() {
                if (!backgroundMusic) return;
                
                if (isMusicMuted) {
                    backgroundMusic.muted = false;
                    isMusicMuted = false;
                    musicControl.classList.remove('muted');
                    
                    if (!isMusicPlaying) {
                        backgroundMusic.play().catch(e => console.log('æ’­æ”¾å¤±è´¥:', e));
                        isMusicPlaying = true;
                    }
                } else {
                    backgroundMusic.muted = true;
                    isMusicMuted = true;
                    musicControl.classList.add('muted');
                }
            });
        }
        
        document.getElementById('confirmBtn').addEventListener('click', function() {
            const mainModal = document.getElementById('mainModal');
            mainModal.classList.remove('active');
            
            setTimeout(() => {
                startMiniModals();
            }, 500);
        });
        
        function startMiniModals() {
            let modalCount = 0;
            const isMobile = isMobileDevice();
            const maxModals = isMobile ? 80 : 200;
            
            const interval = setInterval(() => {
                if (modalCount >= maxModals) {
                    clearInterval(interval);
                    // æ˜¾ç¤ºæœ€ç»ˆç¥ç¦
                    setTimeout(() => {
                        showFinalBlessing();
                    }, 2000);
                    return;
                }
                
                const numToCreate = Math.random() > 0.5 ? 2 : 1;
                
                for (let i = 0; i < numToCreate; i++) {
                    if (modalCount < maxModals) {
                        createMiniModal(isMobile);
                        modalCount++;
                    }
                }
            }, 300);
        }
        
        function createMiniModal(isMobile) {
            const modal = document.createElement('div');
            modal.className = 'mini-modal';
            
            const effectNum = Math.floor(Math.random() * 3) + 1;
            modal.classList.add(`effect-${effectNum}`);
            
            const textEffectRandom = Math.random();
            if (textEffectRandom < 0.2) {
                modal.classList.add('text-effect-fadein');
            }
            
            const headerClass = headerClasses[Math.floor(Math.random() * headerClasses.length)];
            const message = birthdayMessages[Math.floor(Math.random() * birthdayMessages.length)];
            
            modal.innerHTML = `
                <div class="mini-modal-header ${headerClass}">ğŸ‚ç”Ÿæ—¥ç¥ç¦</div>
                <div class="mini-modal-content">${message}</div>
            `;
            
            let randomX, randomY;
            if (isMobile) {
                const extraMargin = 50;
                randomX = Math.floor(Math.random() * (window.innerWidth + 2 * extraMargin)) - extraMargin;
                randomY = Math.floor(Math.random() * (window.innerHeight + 2 * extraMargin)) - extraMargin;
            } else {
                const maxX = window.innerWidth - 220;
                const maxY = window.innerHeight - 160;
                randomX = Math.max(10, Math.floor(Math.random() * maxX));
                randomY = Math.max(10, Math.floor(Math.random() * maxY));
            }
            
            modal.style.left = `${randomX}px`;
            modal.style.top = `${randomY}px`;
            
            let rotation = 0;
            if (Math.random() < 0.3) {
                rotation = (Math.random() * 10) - 5;
            }
            
            switch(effectNum) {
                case 1:
                    modal.style.transform = `scale(0.8) translateY(-30px) rotate(${rotation}deg)`;
                    break;
                case 2:
                    modal.style.transform = `scale(0.6) translateX(-50px) rotate(${rotation}deg)`;
                    break;
                case 3:
                    modal.style.transform = `scale(0.7) rotate(${rotation - 10}deg)`;
                    break;
            }
            
            document.body.appendChild(modal);
            
            addModalInteractions(modal);
            
            setTimeout(() => {
                modal.classList.add('active');
                modal.style.transform = `scale(1) translate(0) rotate(${rotation}deg)`;
            }, 50);
            
            // éšæœºæ”¹å˜èƒŒæ™¯é¢œè‰²
            if (Math.random() < 0.1) {
                changeBackgroundColor();
            }
        }
        
        function changeBackgroundColor() {
            const currentClass = document.body.className;
            let newClass;
            do {
                newClass = bgClasses[Math.floor(Math.random() * bgClasses.length)];
            } while (newClass === currentClass);
            
            document.body.classList.add('bg-changing');
            document.body.className = newClass;
            
            setTimeout(() => {
                document.body.classList.remove('bg-changing');
            }, 1000);
        }
        
        function addModalInteractions(modal) {
            let clickTimer = null;
            let isDoubleClick = false;
            
            modal.addEventListener('click', function(e) {
                if (isDoubleClick) {
                    isDoubleClick = false;
                    return;
                }
                
                if (clickTimer) {
                    clearTimeout(clickTimer);
                    clickTimer = null;
                    isDoubleClick = true;
                    closeModal(modal);
                    return;
                }
                
                clickTimer = setTimeout(() => {
                    clickTimer = null;
                    modal.classList.add('clicked');
                    createHeartAnimation(e.clientX, e.clientY);
                    
                    // æ·»åŠ ç”Ÿæ—¥ç‰¹æ•ˆ
                    if (Math.random() < 0.3) {
                        createBirthdayEffect(e.clientX, e.clientY);
                    }
                    
                    setTimeout(() => {
                        modal.classList.remove('clicked');
                    }, 600);
                }, 300);
            });
            
            modal.addEventListener('mousedown', startDrag);
            modal.addEventListener('touchstart', startDrag);
            
            function startDrag(e) {
                e.preventDefault();
                isDragging = true;
                currentDragElement = modal;
                
                const rect = modal.getBoundingClientRect();
                if (e.type === 'mousedown') {
                    dragOffsetX = e.clientX - rect.left;
                    dragOffsetY = e.clientY - rect.top;
                } else {
                    dragOffsetX = e.touches[0].clientX - rect.left;
                    dragOffsetY = e.touches[0].clientY - rect.top;
                }
                
                modal.style.transition = 'none';
                modal.style.zIndex = '1001';
                
                document.addEventListener('mousemove', onDrag);
                document.addEventListener('touchmove', onDrag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchend', stopDrag);
            }
            
            function onDrag(e) {
                if (!isDragging || currentDragElement !== modal) return;
                
                e.preventDefault();
                let clientX, clientY;
                
                if (e.type === 'mousemove') {
                    clientX = e.clientX;
                    clientY = e.clientY;
                } else {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                }
                
                modal.style.left = `${clientX - dragOffsetX}px`;
                modal.style.top = `${clientY - dragOffsetY}px`;
            }
            
            function stopDrag() {
                isDragging = false;
                currentDragElement = null;
                modal.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                modal.style.zIndex = '999';
                
                document.removeEventListener('mousemove', onDrag);
                document.removeEventListener('touchmove', onDrag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchend', stopDrag);
            }
        }
        
        function createHeartAnimation(x, y) {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = 'â¤ï¸';
            heart.style.left = `${x - 10}px`;
            heart.style.top = `${y - 10}px`;
            
            document.body.appendChild(heart);
            
            setTimeout(() => {
                heart.remove();
            }, 1000);
        }
        
        function createBirthdayEffect(x, y) {
            const effects = ['ğŸ‚', 'ğŸ‰', 'ğŸ', 'â­', 'âœ¨', 'ğŸ’'];
            const effect = effects[Math.floor(Math.random() * effects.length)];
            
            const effectEl = document.createElement('div');
            effectEl.className = 'heart';
            effectEl.innerHTML = effect;
            effectEl.style.left = `${x - 10}px`;
            effectEl.style.top = `${y - 10}px`;
            effectEl.style.fontSize = '28px';
            
            document.body.appendChild(effectEl);
            
            setTimeout(() => {
                effectEl.remove();
            }, 1000);
        }
        
        function closeModal(modal) {
            modal.style.transition = 'all 0.3s ease';
            modal.style.opacity = '0';
            modal.style.transform = 'scale(0.5)';
            
            setTimeout(() => {
                if (modal.parentNode) {
                    modal.parentNode.removeChild(modal);
                }
            }, 300);
        }
        
        function showFinalBlessing() {
            const finalModal = document.createElement('div');
            finalModal.className = 'main-modal';
            finalModal.innerHTML = `
                <div class="cake-icon">ğŸ‚</div>
                <h2>æ¨å‹¤å§å§ï¼Œç”Ÿæ—¥å¿«ä¹ï¼</h2>
                <p>äº²çˆ±çš„å§å§ï¼š</p>
                <p>ä½ æ˜¯æˆ‘å¿ƒä¸­æœ€æ¸©æš–ã€æœ€ç¾å¥½çš„å­˜åœ¨ï¼</p>
                <p>æ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡é˜³å…‰ä¸æ¬¢ç¬‘ï¼</p>
                <p>æ„¿ä½ çš„ç”Ÿæ´»ç”œç”œèœœèœœï¼Œå¹¸ç¦æ°¸è¿œï¼</p>
                <p>å¼Ÿå¼Ÿæ°¸è¿œçˆ±ä½ ã€æ”¯æŒä½ ï¼â¤ï¸</p>
                <div class="birthday-decoration">
                    <span class="decoration-icon">ğŸˆ</span>
                    <span class="decoration-icon">ğŸ</span>
                    <span class="decoration-icon">âœ¨</span>
                    <span class="decoration-icon">â¤ï¸</span>
                    <span class="decoration-icon">ğŸŒ¸</span>
                </div>
                <button id="restartBtn">å†çœ‹ä¸€æ¬¡ç¥ç¦</button>
            `;
            
            document.body.appendChild(finalModal);
            
            setTimeout(() => {
                finalModal.classList.add('active');
            }, 100);
            
            finalModal.querySelector('#restartBtn').addEventListener('click', function() {
                finalModal.classList.remove('active');
                setTimeout(() => {
                    finalModal.remove();
                    location.reload();
                }, 500);
            });
        }
    </script>
</body>
</html>
